var LenaJS={getImage:function(a){var t=document.createElement("canvas");t.width=a.width,t.height=a.height;var n=t.getContext("2d");return n.drawImage(a,0,0),n.getImageData(0,0,a.width,a.height)},printCanvas:function(a,t){a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0)},filterImage:function(a,t,n){var r=[this.getImage(n)];return this.printCanvas(a,t.apply(null,r))},redrawCanvas:function(a,t){var n=a.getContext("2d");return n=[n.getImageData(0,0,a.width,a.height)],this.printCanvas(a,t.apply(null,n))},convolution:function(a,t){for(var n=Math.round(Math.sqrt(t.length)),r=Math.floor(n/2),e=a.data,o=a.width,d=a.height,i=document.createElement("canvas").getContext("2d").createImageData(o,d),u=0;u<d;u++)for(var h=0;h<o;h++){for(var c=4*(u*o+h),l=0,f=0,g=0,v=0;v<n;v++)for(var s=0;s<n;s++){var m=u+v-r,p=h+s-r;if(m>=0&&m<d&&p>=0&&p<o){var M=4*(m*o+p),w=t[v*n+s];l+=e[M]*w,f+=e[M+1]*w,g+=e[M+2]*w}}i.data[c]=l,i.data[c+1]=f,i.data[c+2]=g,i.data[c+3]=255}return i},gradient:function(a,t){for(var n=a.data,r=a.width,e=a.height,o=t.data,d=document.createElement("canvas").getContext("2d").createImageData(r,e),i=new Array(n.length).fill(0),u=0;u<e;u++)for(var h=0;h<r;h++){var c=4*(u*r+h);d.data[c]=Math.sqrt(Math.pow(n[c],2)+Math.pow(o[c],2)),d.data[c+1]=Math.sqrt(Math.pow(n[c+1],2)+Math.pow(o[c+1],2)),d.data[c+2]=Math.sqrt(Math.pow(n[c+2],2)+Math.pow(o[c+2],2)),d.data[c+3]=255,i[c]=Math.atan2(o[c],n[c]),i[c+1]=Math.atan2(o[c+1],n[c+1]),i[c+2]=Math.atan2(o[c+2],n[c+2]),i[c+3]=255}return{magnitude:d,direction:i}},histogram:function(a){"use strict";for(var t=this.getImage(a),n=new Array(257).join("0").split(""),r={r:n.map(Number),g:n.map(Number),b:n.map(Number)},e=0;e<t.data.length;e+=4)r.r[t.data[e]]++,r.g[t.data[e+1]]++,r.b[t.data[e+2]]++;return r},nonMaximumSuppression:function(a,t){for(var n=Math.round(Math.sqrt(25)),r=Math.floor(n/2),e=a.data,o=a.width,d=a.height,i=document.createElement("canvas").getContext("2d").createImageData(o,d),u=0;u<d;u++)for(var h=0;h<o;h++){for(var c=4*(u*o+h),l=e[c],f=e[c+1],g=e[c+2],v=0;v<n;v++)for(var s=0;s<n;s++){var m=u+v-r,p=h+s-r;if(m>=0&&m<d&&p>=0&&p<o){var M=4*(m*o+p),w=Math.atan2(m-u,p-h);l=e[M]*Math.abs(Math.cos(t[c]-w))>l?0:l,f=e[M+1]*Math.abs(Math.cos(t[c+1]-w))>f?0:f,g=e[M+2]*Math.abs(Math.cos(t[c+2]-w))>g?0:g}}i.data[c]=2*l,i.data[c+1]=2*f,i.data[c+2]=2*g,i.data[c+3]=255}return i},bigGaussian:function(a){return LenaJS.convolution(a,[2/159,4/159,5/159,4/159,2/159,4/159,9/159,12/159,9/159,4/159,5/159,12/159,15/159,12/159,5/159,4/159,9/159,12/159,9/159,4/159,2/159,4/159,5/159,4/159,2/159])},canny:function(a){a=LenaJS.bigGaussian(a);var t=LenaJS.sobelHorizontal(a),n=LenaJS.sobelVertical(a),r=LenaJS.gradient(t,n),e=LenaJS.laplacian(a);return a=LenaJS.nonMaximumSuppression(e,r.direction),LenaJS.thresholding(a,8)},gaussian:function(a){return LenaJS.convolution(a,[1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16])},grayscale:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=a.data[t+1]=a.data[t+2]=.2126*a.data[t]+.7152*a.data[t+1]+.0722*a.data[t+2];return a},highpass:function(a){return LenaJS.convolution(a,[-1,-1,-1,-1,8,-1,-1,-1,-1])},invert:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=255-a.data[t],a.data[t+1]=255-a.data[t+1],a.data[t+2]=255-a.data[t+2];return a},laplacian:function(a){return LenaJS.convolution(a,[0,-1,0,-1,4,-1,0,-1,0])},lowpass3:function(a){var t=1/9;return LenaJS.convolution(a,[t,t,t,t,t,t,t,t,t])},lowpass5:function(a){var t=.04;return LenaJS.convolution(a,[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t])},mirror:function(a){for(var t=[],n=4*a.width,r=0;r<a.height;r++)for(var e=r*n,o=a.width/2,d=0;d<o;d++){var i=4*d,u=i+e,h=n-i-4+e;t[0]=a.data[u],t[1]=a.data[u+1],t[2]=a.data[u+2],t[3]=a.data[u+3],a.data[u]=a.data[h],a.data[u+1]=a.data[h+1],a.data[u+2]=a.data[h+2],a.data[u+3]=a.data[h+3],a.data[h]=t[0],a.data[h+1]=t[1],a.data[h+2]=t[2],a.data[h+3]=t[3]}return a},prewittHorizontal:function(a){return LenaJS.convolution(a,[1/3,1/3,1/3,0,0,0,-1/3,-1/3,-1/3])},prewittVertical:function(a){return LenaJS.convolution(a,[-1/3,0,1/3,-1/3,0,1/3,-1/3,0,1/3])},red:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=t[n],t[n+1]=0,t[n+2]=0;return a},green:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=0,t[n+2]=0;return a},blue:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=0,t[n+1]=0;return a},roberts:function(a){return LenaJS.convolution(a,[0,0,0,1,-1,0,0,0,0])},saturation:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=2.31366*a.data[t]+-1.15596*a.data[t+1]+-.1558*a.data[t+2],a.data[t+1]=-.58634*a.data[t]+1.7440399999999998*a.data[t+1]+-.1558*a.data[t+2],a.data[t+2]=-.58634*a.data[t]+-1.15596*a.data[t+1]+(2.9-.1558)*a.data[t+2];return a},sepia:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=a.data[t+1]=a.data[t+2]=.3*a.data[t]+.59*a.data[t+1]+.11*a.data[t+2],a.data[t]+=40,a.data[t+1]+=20,a.data[t+2]-=20;return a},sharpen:function(a){return LenaJS.convolution(a,[0,-.2,0,-.2,1.8,-.2,0,-.2,0])},sobelHorizontal:function(a){return LenaJS.convolution(a,[1/4,.5,1/4,0,0,0,-1/4,-.5,-1/4])},sobelVertical:function(a){return LenaJS.convolution(a,[1/4,0,-1/4,.5,0,-.5,1/4,0,-1/4])},thresholding:function(a,t){for(var n=0;n<a.data.length;n+=4)a.data[n]=a.data[n+1]=a.data[n+2]=.2126*a.data[n]+.7152*a.data[n+1]+.0722*a.data[n+2]>(t||128)?255:0;return a}};